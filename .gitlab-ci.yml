image: lorisleiva/laravel-docker:latest

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    # We only want to cache the vendor folder.
    - vendor/

codestyle:
  stage: test
  cache: {} # Override with an empty object.
  script:
    - composer global require tightenco/tlint
    - tlint lint app
  allow_failure: true

phpunit:
  stage: test
  script:
    - apk add --no-cache imap-dev krb5-dev openssl-dev
    - PHP_OPENSSL=yes docker-php-ext-configure imap --with-kerberos --with-imap-ssl
    - docker-php-ext-install imap
    - composer install --prefer-dist --no-ansi --no-interaction --no-progress --no-scripts
    - cp .env.example .env
    - php artisan key:generate
    - phpunit --coverage-text --colors=never
