image: lorisleiva/laravel-docker:latest

.before_script_composer:
  rules:
    - changes:
      - "**/*.php"
  before_script:
    - apk add --no-cache imap-dev krb5-dev openssl-dev
    - PHP_OPENSSL=yes docker-php-ext-configure imap --with-kerberos --with-imap-ssl
    - docker-php-ext-install imap xdebug
    - docker-php-ext-enable xdebug
    - composer install --prefer-dist --no-ansi --no-interaction --no-progress --no-scripts

phpunit:
  extends: .before_script_composer
  stage: test
  script:
    - cp .env.example .env
    - php artisan key:generate
    - ./vendor/bin/phpunit --coverage-text --colors=never
