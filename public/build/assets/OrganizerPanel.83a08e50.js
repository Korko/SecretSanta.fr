import{F as W}from"./Fetcher.d9ce79c1.js";import{N as D}from"./NavPageLink.0f4360eb.js";import{d as C,f,a as E}from"./fetch.c0ba397d.js";import{T as q,E as R}from"./Tooltip.8ea7c3b7.js";import{o as r,d as l,e,t as n,j as h,k as B,y as G,z as U,u as H,p as $,m as T,r as g,a as p,A as j,F as P,l as M,c as k,w as c,b as y,n as Q,h as Y}from"./app.4974e8a0.js";import{_ as z}from"./plugin-vue_export-helper.f2aa9cb4.js";import{E as Z}from"./EmailStatus.1feea139.js";import"./Fetcher.f493122c.js";var A={data:()=>({data:{},states:{},previousState:null,state:null}),methods:{send(t,i){this.data=i||{};var a=this.states[this.state][t]||this.states[this.state]["*"];a&&(this.previousState=this.state,this.state=a,(this["state"+this.state[0].toUpperCase()+this.state.slice(1)]||function(){})())}}};const J={mixins:[A],inheritAttrs:!1,props:{modelValue:{type:String,required:!0},submit:{type:Function,required:!0},validate:{type:Function,required:!0},disabled:{type:Boolean,default:!1}},data(){return{states:Object.freeze({view:{edit:"editing"},editing:{validate:"editingValidating",cancel:"view",blur:"editingBlur"},editingBlur:{same:"view",different:"editingValidating"},editingValid:{validate:"editingValidating",submit:"viewUpdating",cancel:"view",blur:"editingBlur"},editingInvalid:{validate:"editingValidating",cancel:"view"},editingValidating:{valid:"editingValid",invalid:"editingInvalid"},viewUpdating:{success:"viewUpdated",error:"viewError"},viewUpdated:{edit:"editing",timer:"view"},viewError:{edit:"editing",resend:"viewUpdating"}}),state:"view",newValue:this.modelValue}},computed:{isSame(){return this.newValue===this.modelValue},view(){return this.state.startsWith("view")},updating(){return this.state==="viewUpdating"}},methods:{onBlur(){this.send("blur")},onCancel(){this.send("cancel")},onInput(){this.send("validate")},onSubmit(){this.send("submit")},onResend(){this.send("resend")},stateView(){this.newValue=this.modelValue},stateEditing(){this.$nextTick(()=>this.$refs.input.focus())},stateEditingBlur(){this.isSame?this.send("same"):this.send("different")},stateEditingValidating(){this.validate(this.newValue).then(()=>{this.send("valid")}).catch(t=>{this.send("invalid",{message:t})})},stateViewUpdating(){this.submit(this.newValue).then(()=>{this.send("success")}).catch(t=>{this.send("error",{message:t})})},stateViewUpdated(){setTimeout(()=>{this.send("timer")},5e3)}}},b=t=>($("data-v-2b947939"),t=t(),T(),t),K=["disabled"],X=["data-state","data-previous-state"],x={role:"alert",style:{display:"none"}},tt={key:0,class:"input-group-prepend"},et=b(()=>e("i",{class:"input-group-text fas fa-spinner fa-spin"},null,-1)),it=[et],st={key:1,class:"input-group-prepend"},at=b(()=>e("i",{class:"input-group-text fas fa-check"},null,-1)),nt=[at],rt={key:2,class:"input-group-prepend"},ot=["title"],dt=["disabled","aria-invalid","title"],lt={key:3,class:"invalid-tooltip"},ut={class:"input-group-append"},ct=["disabled"],ht=b(()=>e("i",{class:"fas fa-sync"},null,-1)),pt=[ht],mt=["disabled"],_t=b(()=>e("i",{class:"fas fa-edit"},null,-1)),gt=[_t],ft=["disabled"],bt=b(()=>e("i",{class:"fas fa-check-circle"},null,-1)),vt=[bt],wt=b(()=>e("i",{class:"fas fa-times-circle"},null,-1)),yt=[wt];function kt(t,i,a,S,u,s){return r(),l("form",{method:"post",autocomplete:"off",onSubmit:i[6]||(i[6]=H((...o)=>s.onSubmit&&s.onSubmit(...o),["prevent"]))},[e("fieldset",{disabled:s.updating||a.disabled},[e("div",{class:"input-group","data-state":u.state,"data-previous-state":t.previousState},[e("h2",x,n(t.data.message),1),s.updating?(r(),l("div",tt,it)):h("v-if",!0),u.state==="viewUpdated"?(r(),l("div",st,nt)):h("v-if",!0),u.state==="viewError"?(r(),l("div",rt,[e("i",{class:"input-group-text fas fa-exclamation-circle",title:t.data.message},null,8,ot)])):h("v-if",!0),B(e("input",U({ref:"input","onUpdate:modelValue":i[0]||(i[0]=o=>u.newValue=o),name:"input"},t.$attrs,{class:{"form-control":!0,"is-invalid":u.state.endsWith("Invalid")},disabled:s.view,"aria-invalid":u.state.endsWith("Invalid"),title:t.data.message,onInput:i[1]||(i[1]=(...o)=>s.onInput&&s.onInput(...o))}),null,16,dt),[[G,u.newValue]]),u.state.endsWith("Invalid")?(r(),l("div",lt,n(t.data.message),1)):h("v-if",!0),e("div",ut,[u.state==="viewError"?(r(),l("button",{key:0,type:"button",class:"btn btn-outline-primary",disabled:a.disabled,onClick:i[2]||(i[2]=(...o)=>s.onResend&&s.onResend(...o))},pt,8,ct)):h("v-if",!0),u.state.startsWith("view")?(r(),l("button",{key:1,type:"button",class:"btn btn-outline-primary",disabled:a.disabled,onClick:i[3]||(i[3]=o=>t.send("edit"))},gt,8,mt)):h("v-if",!0),u.state.startsWith("edit")?(r(),l("button",{key:2,type:"button",class:"btn btn-outline-success",disabled:s.isSame||!u.state.endsWith("Valid")||a.disabled,onClick:i[4]||(i[4]=(...o)=>s.onSubmit&&s.onSubmit(...o))},vt,8,ft)):h("v-if",!0),u.state.startsWith("edit")?(r(),l("button",{key:3,type:"button",class:"btn btn-outline-danger",onClick:i[5]||(i[5]=(...o)=>s.onCancel&&s.onCancel(...o))},yt)):h("v-if",!0)])],8,X)],8,K)],32)}var zt=z(J,[["render",kt],["__scopeId","data-v-2b947939"],["__file","/home/korko/secretsanta.next/resources/js/Components/InputEdit.vue"]]);const Vt={components:{InputEdit:zt,EmailStatus:Z},props:{name:{type:String,required:!0},email:{type:String,required:!0},target:{type:String},mail:{type:Object,required:!0},participants:{type:Object,required:!0},finished:{type:Boolean,required:!0},canWithdraw:{type:Boolean,required:!0},validate:{type:Function,required:!0},updateEmail:{type:Function,required:!0},updateName:{type:Function,required:!0}}},St={key:0},jt={key:1},Et=e("i",{class:"fas fa-minus"},null,-1);function Pt(t,i,a,S,u,s){const o=g("InputEdit"),m=g("EmailStatus");return r(),l("tr",null,[e("td",null,[p(o,{modelValue:a.name,submit:a.updateName,validate:d=>a.validate("name",d),disabled:a.finished},null,8,["modelValue","submit","validate","disabled"])]),e("td",null,[p(o,{modelValue:a.email,submit:a.updateEmail,validate:d=>a.validate("email",d),disabled:a.finished},null,8,["modelValue","submit","validate","disabled"])]),a.finished?(r(),l("td",St,n(a.target),1)):h("v-if",!0),e("td",null,[p(m,{delivery_status:a.mail.delivery_status,last_update:a.mail.updated_at,disabled:a.finished,onRedo:i[0]||(i[0]=d=>t.$emit("resend"))},null,8,["delivery_status","last_update","disabled"])]),a.canWithdraw?(r(),l("td",jt,[e("button",{type:"button",class:"btn btn-outline-danger participant-remove",onClick:i[1]||(i[1]=d=>t.confirmWithdrawal(t.k))},[Et,e("span",null,n(t.$t("organizer.withdraw.button")),1)])])):h("v-if",!0)])}var Ct=z(Vt,[["render",Pt],["__file","/home/korko/secretsanta.next/resources/js/Components/OrganizerParticipantRow.vue"]]),Ut="/build/assets/srikanta-h-u-TrGVhbsUf40-unsplash.be9b6bde.avif",$t="/build/assets/srikanta-h-u-TrGVhbsUf40-unsplash.4471f4b6.webp",I="/build/assets/srikanta-h-u-TrGVhbsUf40-unsplash.6816af8d.jpg",Tt="/build/assets/lynda-hinton-QyDLHeUerd4-unsplash.9b9c28b0.avif",It="/build/assets/lynda-hinton-QyDLHeUerd4-unsplash.4ee30b51.webp",O="/build/assets/lynda-hinton-QyDLHeUerd4-unsplash.5f3e2c02.jpg",F="/build/assets/rune-haugseng-UCzjZPCGV1Y-unsplash.3341c429.avif",L="/build/assets/rune-haugseng-UCzjZPCGV1Y-unsplash.135a646a.webp",V="/build/assets/rune-haugseng-UCzjZPCGV1Y-unsplash.fec52c3e.jpg",Ot="/build/assets/mike-arney-9r-_2gzP37k-unsplash.080a6716.avif",Ft="/build/assets/mike-arney-9r-_2gzP37k-unsplash.eca00fd8.webp",N="/build/assets/mike-arney-9r-_2gzP37k-unsplash.6dd52eac.jpg";const Lt={components:{Tooltip:q,ParticipantRow:Ct},props:{participants:{type:Object,required:!0},draw:{type:Object,required:!0},routes:{type:Object,required:!0}},computed:{canWithdraw(){return Object.keys(this.participants).length>3},checkUpdates(){return!!Object.values(this.participants).find(t=>t.mail.delivery_status!=="error")},finished(){return!!this.draw.finished_at},endDateLong(){return new Date(this.draw.finished_at).toLocaleString("fr-FR",{day:"numeric",month:"long",year:"numeric"})},deletionDateLong(){return new Date(this.draw.deletes_at).toLocaleString("fr-FR",{day:"numeric",month:"long",year:"numeric"})}},created(){R.channel("draw."+this.draw.hash).listen(".mail.update",t=>{var i=Object.keys(this.participants).find(a=>this.participants[a].mail.id===t.id);i&&(this.participants[i].mail.delivery_status=t.delivery_status,this.participants[i].mail.updated_at=t.updated_at)}),window.localStorage.setItem("secretsanta",JSON.stringify(C(JSON.parse(window.localStorage.getItem("secretsanta"))||{},{[this.draw.hash]:{title:this.draw.mail_title,creation:this.draw.created_at,deletion:this.draw.deletes_at,organizerName:this.draw.organizer.name,links:{org:{link:window.location.href}}}})))},methods:{confirmPurge(){let t={okText:this.$t("organizer.purge.confirm.ok"),cancelText:this.$t("organizer.purge.confirm.cancel"),verification:this.$t("organizer.purge.confirm.value"),verificationHelp:this.$t("organizer.purge.confirm.help"),type:"hard",customClass:"purge"},i={title:this.$t("organizer.purge.confirm.title",{deletion:this.deletionDateLong}),body:""};this.draw.next_solvable&&!this.finished?i.body=this.$t("organizer.purge.confirm.body_final"):this.finished?i.body=this.$t("organizer.purge.confirm.body_finished"):i.body=this.$t("organizer.purge.confirm.body_nofinal"),this.$dialog.confirm(i,t).then(this.purge)},purge(){return f(this.routes.deleteUrl,"DELETE").then(t=>{this.$dialog.alert(t.message).then(()=>window.location.pathname="/")})},resendTarget(t){return this.participants[t].mail.delivery_status="created",this.participants[t].mail.updated_at=new Date().getTime(),f(this.participants[t].resendTargetUrl)},updateEmail(t,i){return this.participants[t].email=i,this.participants[t].mail.delivery_status="created",this.participants[t].mail.updated_at=new Date().getTime(),f(this.participants[t].changeEmailUrl,"POST",{email:i}).catch(a=>Promise.reject(a.errors.email[0]))},updateName(t,i){return this.participants[t].name=i,f(this.participants[t].changeNameUrl,"POST",{name:i}).catch(a=>Promise.reject(a.errors.name[0]))},confirmWithdrawal(t){let i={okText:this.$t("organizer.withdraw.confirm.ok"),cancelText:this.$t("organizer.withdraw.confirm.cancel"),verification:this.$t("organizer.withdraw.confirm.value"),verificationHelp:this.$t("organizer.withdraw.confirm.help"),type:"hard",customClass:"withdraw"};this.$dialog.confirm({title:this.$t("organizer.withdraw.confirm.title",{deletion:this.deletionDateLong}),body:this.$t("organizer.withdraw.confirm.body",{name:this.participants[t].name})},i).then(()=>this.withdraw(t))},withdraw(t){return f(this.participants[t].withdrawalUrl).then(i=>{this.$delete(this.participants,t),this.$dialog.alert(i.message)})},download(){f(this.routes.csvInitUrl,"GET","",{responseType:"blob"}).then(t=>{E(t,"secretsanta_"+this.draw.hash+"_init.csv","text/csv")})},downloadPlus(){f(this.routes.csvFinalUrl,"GET","",{responseType:"blob"}).then(t=>{E(t,"secretsanta_"+this.draw.hash+"_full.csv","text/csv")})}}},_=t=>($("data-v-2026b2d8"),t=t(),T(),t),Nt=Ut,Wt=$t,Dt=I,qt=Tt,Rt=It,Bt=O,Gt=F,Ht=L,Mt=V,Qt=Ot,Yt=Ft,Zt=N,At=F,Jt=L,Kt=V,Xt={key:0,class:"alert alert-warning",role:"alert"},xt={class:"table table-hover"},te={class:"table-active"},ee={key:0,style:{width:"25%"},scope:"col"},ie={key:1,style:{width:"3%"},scope:"col"},se=_(()=>e("picture",null,[e("source",{srcset:Nt,type:"image/avif"}),e("source",{srcset:Wt,type:"image/webp"}),e("source",{srcset:Dt,type:"image/jpg"}),e("img",{class:"media-object",src:I})],-1)),ae={class:"text-content"},ne=_(()=>e("i",{class:"fas fa-calendar-check"},null,-1)),re=_(()=>e("picture",null,[e("source",{srcset:qt,type:"image/avif"}),e("source",{srcset:Rt,type:"image/webp"}),e("source",{srcset:Bt,type:"image/jpg"}),e("img",{class:"media-object",src:O})],-1)),oe={class:"text-content"},de=_(()=>e("i",{class:"fas fa-trash"},null,-1)),le=_(()=>e("picture",null,[e("source",{srcset:Gt,type:"image/avif"}),e("source",{srcset:Ht,type:"image/webp"}),e("source",{srcset:Mt,type:"image/jpg"}),e("img",{class:"media-object",src:V})],-1)),ue={class:"text-content"},ce=_(()=>e("i",{class:"fas fa-download"},null,-1)),he=_(()=>e("picture",null,[e("source",{srcset:Qt,type:"image/avif"}),e("source",{srcset:Yt,type:"image/webp"}),e("source",{srcset:Zt,type:"image/jpg"}),e("img",{class:"media-object",src:N})],-1)),pe={class:"text-content"},me=["disabled"],_e=_(()=>e("i",{class:"fas fa-download"},null,-1)),ge=_(()=>e("picture",null,[e("source",{srcset:At,type:"image/avif"}),e("source",{srcset:Jt,type:"image/webp"}),e("source",{srcset:Kt,type:"image/jpg"}),e("img",{class:"media-object",src:V})],-1)),fe={class:"text-content"},be=_(()=>e("i",{class:"fas fa-download"},null,-1));function ve(t,i,a,S,u,s){const o=g("ParticipantRow"),m=g("tooltip");return r(),l("div",null,[s.finished?(r(),l("div",Xt,n(t.$t("organizer.finished",{finished_at:s.endDateLong})),1)):h("v-if",!0),e("table",xt,[e("caption",null,n(t.$t("organizer.list.caption")),1),e("thead",null,[e("tr",te,[e("th",{style:j(s.finished?"width: 25%":"width: 33%"),scope:"col"},n(t.$t("organizer.list.name")),5),e("th",{style:j(s.finished?"width: 25%":"width: 33%"),scope:"col"},n(t.$t("organizer.list.email")),5),s.finished?(r(),l("th",ee,n(t.$t("organizer.list.target")),1)):h("v-if",!0),e("th",{style:j(s.canWithdraw?"width: 25%":"width: 33%"),scope:"col"},n(t.$t("organizer.list.status")),5),!s.finished&&s.canWithdraw?(r(),l("th",ie,n(t.$t("organizer.list.withdraw")),1)):h("v-if",!0)])]),e("tbody",null,[(r(!0),l(P,null,M(a.participants,(d,v)=>(r(),k(o,U({key:d.hash},d,{participants:a.participants,finished:s.finished,canWithdraw:s.canWithdraw,updateEmail:w=>s.updateEmail(v,w),updateName:w=>s.updateName(v,w),onResend:()=>s.resendTarget(v)}),null,16,["participants","finished","canWithdraw","updateEmail","updateName","onResend"]))),128))])]),s.finished?h("v-if",!0):(r(),k(m,{key:1,direction:"top"},{tooltip:c(()=>[se,e("div",ae,[e("h3",null,n(t.$t("organizer.end.button-tooltip.title")),1),e("p",null,n(t.$t("organizer.end.button-tooltip.content")),1)])]),default:c(()=>[e("button",{type:"button",class:"btn btn-warning",onClick:i[0]||(i[0]=(...d)=>t.confirmEnd&&t.confirmEnd(...d))},[ne,y(" "+n(t.$t("organizer.end.button")),1)])]),_:1})),p(m,{direction:"top"},{tooltip:c(()=>[re,e("div",oe,[e("h3",null,n(t.$t("organizer.purge.button-tooltip.title")),1),e("p",null,n(t.$t("organizer.purge.button-tooltip.content")),1)])]),default:c(()=>[e("button",{type:"button",class:"btn btn-danger",onClick:i[1]||(i[1]=(...d)=>s.confirmPurge&&s.confirmPurge(...d))},[de,y(" "+n(t.$t("organizer.purge.button",{deletes_at:s.deletionDateLong})),1)])]),_:1}),a.draw.next_solvable?(r(),l(P,{key:2},[p(m,{direction:"top"},{tooltip:c(()=>[le,e("div",ue,[e("h3",null,n(t.$t("organizer.download.button_initial-tooltip.title")),1),e("p",null,n(t.$t("organizer.download.button_initial-tooltip.content")),1)])]),default:c(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:i[2]||(i[2]=(...d)=>s.download&&s.download(...d))},[ce,y(" "+n(t.$t("organizer.download.button_initial")),1)])]),_:1}),p(m,{direction:"top"},{tooltip:c(()=>[he,e("div",pe,[e("h3",null,n(t.$t("organizer.download.button_final-tooltip.title")),1),e("p",null,n(t.$t("organizer.download.button_final-tooltip.explain")),1)])]),default:c(()=>[e("button",{disabled:!s.finished,type:"button",class:"btn btn-primary",onClick:i[3]||(i[3]=(...d)=>s.downloadPlus&&s.downloadPlus(...d))},[_e,y(" "+n(t.$t("organizer.download.button_final")),1)],8,me)]),_:1})],64)):(r(),k(m,{key:3,direction:"top"},{tooltip:c(()=>[ge,e("div",fe,[e("h3",null,n(t.$t("organizer.download.button-tooltip.title")),1),e("p",null,n(t.$t("organizer.download.button-tooltip.content")),1)])]),default:c(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:i[4]||(i[4]=(...d)=>s.download&&s.download(...d))},[be,y(" "+n(t.$t("organizer.download.button")),1)])]),_:1}))])}var we=z(Lt,[["render",ve],["__scopeId","data-v-2026b2d8"],["__file","/home/korko/secretsanta.next/resources/js/Components/OrganizerForm.vue"]]);const ye={components:{FetcherLayout:W,NavPageLink:D,OrganizerForm:we},props:{routes:{type:Object}},methods:{deepMerge:C}};function ke(t,i,a,S,u,s){const o=g("i18n-t"),m=g("NavPageLink"),d=g("OrganizerForm"),v=g("FetcherLayout");return r(),k(v,{src:a.routes.fetch},{"navbar-right":c(()=>[p(m,{href:t.route("form.index")},{default:c(()=>[p(o,{keypath:"common.nav.go"})]),_:1},8,["href"]),p(m,{href:t.route("dashboard")},{default:c(()=>[p(o,{keypath:"common.nav.dashboard"})]),_:1},8,["href"])]),default:c(w=>[p(d,Q(Y(s.deepMerge(w,{routes:a.routes}))),null,16)]),_:1},8,["src"])}var $e=z(ye,[["render",ke],["__file","/home/korko/secretsanta.next/resources/js/Pages/OrganizerPanel.vue"]]);export{$e as default};
